import{_ as f,o as i,c as d,a,n as v,r as _,b,t as c,d as p,e as w,F as m}from"./index-aade91dc.js";const y={name:"download-progress",watch:{downloadProgress(e,t){if(e){let{progress:o,textContent:l}=this.downloadProgress;this.progress=o,this.textContent=l}}},props:{downloadProgress:{type:Object,default:null}},data(){return{progress:null,textContent:null}},methods:{}},V={class:"progress"},$=["textContent"];function k(e,t,o,l,r,n){return i(),d("div",V,[a("div",{ref:"progressDIV",textContent:this.textContent,style:v({width:this.progress}),class:"progress-bar bg-success"},null,12,$)])}const D=f(y,[["render",k]]),C={name:"video-list",components:{DownloadProgress:D},props:{videoList:{type:Object,default:{}},defaultauthor:{type:String,default:""},scrollVid:{type:String,default:null},messageDownload:{type:Object,default:null}},watch:{scrollVid(e,t){e&&this.jumpToTheVideo(e)},async messageDownload(e,t){if(e){let{dowhat:o,info:l,vid:r}=e;switch(o){case"beforeDownInfo":let{author:n}=await this.fetchVideoGet(r);this.$emit("show-the-vid",{author:n,vid:r});break;case"updateDownInfo":this.downvid=r,this.updateDownInfo(l);break;case"completeDownInfo":this.downvid=null,this.downloadFileInfo=null,await this.fetchVideoGet(r);break}}}},data(){return{prehost:"http://localhost:16206/",downvid:null,downloadProgress:null,downloadFileInfo:null}},methods:{jumpToTheVideo(e){let t=this.$refs[e];Array.isArray(t)&&t[0].scrollIntoView({behavior:"smooth"})},async fetchVideoGet(e){let t=`${this.prehost}video/vid/${e}`,l=await(await fetch(t)).json();return this.videoList[e]=l,l},updateDownInfo(e){let{filesize:t,progress:o,cn:l,speed:r,eta:n}=e,s=[t,o,r,n].reduce((h,g)=>String(h).concat(" ",g),"");this.downloadFileInfo=s,this.downloadProgress={progress:o,textContent:s}},showDownInfo(e){return this.downvid===e},fetchOpen(e){let t=`${this.prehost}open/localvideo/${e}`;fetch(t).then()},async fetchRedownload(e){let t=`${this.prehost}video/redownload/${e}`;await fetch(t)},async handleRedownload(e,t){await this.handleVideoDelete(e,t,2),await this.fetchRedownload(e),await this.fetchVideoGet(e)},async fetchVideoDelete(e,t){let o={vid:e,type:t},l=`${this.prehost}video/`,r={method:"delete",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)};await fetch(l,r)},async handleVideoDelete(e,t,o){switch(await this.fetchVideoDelete(e,o),o){case 1:case 3:delete this.videoList[e],Object.keys(this.videoList).length===0&&this.$emit("delete-author",t);break;case 2:await this.fetchVideoGet(e);break}this.$emit("delete-vid",{vid:e,type:o})},copyText(e){window.navigator.clipboard.writeText(e)}}},T=["id"],A={class:"my-0"},x=a("button",{class:"btn disabled"}," info ",-1),L={class:"btn disabled"},S={class:"btn disabled"},j=["onClick"],I=["onClick"],O=["onClick"],P=["onClick"],G={key:1,class:"btn disabled"},N={key:0,class:"my-3"},F={key:1,class:"my-0"},R=a("button",{class:"btn disabled"}," open ",-1),B=["onClick"],z={key:2,class:"my-0"},q=a("button",{class:"btn disabled"}," not exists ",-1),E={class:"btn disabled"},J={class:"my-0"},H=a("button",{class:"btn disabled"}," delete ",-1),K=["onClick"],M=["onClick"],Q=["onClick"];function U(e,t,o,l,r,n){const u=_("DownloadProgress");return i(!0),d(m,null,b(this.videoList,s=>(i(),d("div",{class:"row border my-3",key:s.vid,id:s.vid,ref_for:!0,ref:s.vid},[a("div",A,[x,a("button",L,c(s.vid),1),a("button",S,c(s.quality),1),a("button",{class:"btn btn-outline-info",onClick:h=>n.copyText(s.title)},"title ",8,j),a("button",{class:"btn btn-outline-info",onClick:h=>n.copyText(s.description)},"description ",8,I),a("button",{class:"btn btn-outline-info",onClick:h=>n.copyText(s.vlink)},"video link ",8,O),s.exists===!1?(i(),d("button",{key:0,class:"btn btn-outline-info",onClick:h=>n.handleRedownload(s.vid,s.author)},"redownload ",8,P)):p("",!0),this.showDownInfo(s.vid)?(i(),d("button",G,c(this.downloadFileInfo),1)):p("",!0)]),this.showDownInfo(s.vid)?(i(),d("div",N,[w(u,{downloadProgress:this.downloadProgress},null,8,["downloadProgress"])])):p("",!0),s.exists?(i(),d("div",F,[R,a("button",{style:{"text-overflow":"ellipsis"},onClick:h=>n.fetchOpen(s.vid),class:"btn btn-outline-primary"},c(s.title),9,B)])):(i(),d("div",z,[q,a("button",E,c(s.title),1)])),a("div",J,[H,a("button",{class:"btn btn-outline-danger",onClick:h=>n.handleVideoDelete(s.vid,s.author,1)}," video data ",8,K),a("button",{class:"btn btn-outline-danger",onClick:h=>n.handleVideoDelete(s.vid,s.author,2)}," video file ",8,M),a("button",{class:"btn btn-outline-danger",onClick:h=>n.handleVideoDelete(s.vid,s.author,3)}," video data and file ",8,Q)])],8,T))),128)}const W=f(C,[["render",U]]),X={name:"search-nav",components:{VideoList:W},props:{messageSearch:{type:Object,default:null},messageDownload:{type:Object,default:null}},watch:{async messageSearch(e,t){if(e){let{dowhat:o,info:l}=e;switch(o){case"fetchAllAuthor":await this.fetchAllAuthor();break;case"showTheVideo":await this.showTheVideo(l);break}}}},data(){return{prehost:"http://localhost:16206/",defaultauthor:"All Author",authorList:{},videoList:{},searchType:!0,searchTypText:"author",scrollVid:null}},methods:{async showTheVideo(e){await this.fetchAllAuthor();let{author:t,vid:o}=e;await this.fetchAuthorVideo(t),await new Promise(l=>setTimeout(l,16)),this.scrollVid=o},titleChange(e){this.videoList=null;let t=e.target.value;if(t.length>0){let o=`${this.prehost}video/title/${t}`;fetch(o).then(l=>l.json()).then(l=>{this.videoList=l})}},changeSearchType(){this.searchType=!this.searchType,this.searchTypText=this.searchType?"author":"title",this.videoList=null},deleteVid(e){},deleteAuthor(e){delete this.authorList[e]},goAllAuthor(e){this.$refs.selectOnAuthor.value=e},async fetchAllAuthor(){let e=`${this.prehost}video/authors`,o=await(await fetch(e)).json();this.authorList=o},async fetchAuthorVideo(e){this.$refs.selectOnAuthor.value=e;let t=`${this.prehost}video/author/${e}`,l=await(await fetch(t)).json();this.videoList=l},authorChange(e){let t=e.target.value;t.includes(this.defaultauthor)?this.videoList=null:this.fetchAuthorVideo(t)}},async created(){await this.fetchAllAuthor()}},Y={class:"row my-3"},Z={class:"col-auto"},ee={class:"btn btn-secondary disabled"},te={key:0,class:"col-auto"},se=["value"],oe=["value"],ne={key:1,class:"col-auto"},ae={for:"vtitle"};function le(e,t,o,l,r,n){const u=_("VideoList");return i(),d("div",null,[a("div",Y,[a("div",Z,[a("button",{onClick:t[0]||(t[0]=(...s)=>n.changeSearchType&&n.changeSearchType(...s)),class:"btn btn-outline-primary"},"search "),a("button",ee,c(this.searchTypText),1)]),r.searchType?(i(),d("div",te,[a("select",{ref:"selectOnAuthor",class:"form-select","aria-label":"Default select example",onChange:t[1]||(t[1]=(...s)=>n.authorChange&&n.authorChange(...s))},[a("option",{selected:"",value:this.defaultauthor},c(this.defaultauthor),9,se),(i(!0),d(m,null,b(this.authorList,s=>(i(),d("option",{value:s,key:s},c(s),9,oe))),128))],544)])):(i(),d("div",ne,[a("label",ae,[a("input",{onInput:t[2]||(t[2]=(...s)=>n.titleChange&&n.titleChange(...s)),class:"form-control",id:"vtitle",type:"text",placeholder:"type title to search"},null,32)])]))]),w(u,{videoList:this.videoList,defaultauthor:this.defaultauthor,messageDownload:this.messageDownload,scrollVid:this.scrollVid,onShowTheVid:n.showTheVideo,onDeleteVid:n.deleteVid,onGoAllauthor:n.goAllAuthor,onDeleteAuthor:n.deleteAuthor},null,8,["videoList","defaultauthor","messageDownload","scrollVid","onShowTheVid","onDeleteVid","onGoAllauthor","onDeleteAuthor"])])}const ie=f(X,[["render",le]]),de={name:"search-view",components:{SearchNav:ie},props:{messageSearch:{type:Object,default:null},messageDownload:{type:Object,default:null}}},re={class:"container-fluid"};function he(e,t,o,l,r,n){const u=_("SearchNav");return i(),d("div",re,[w(u,{messageSearch:this.messageSearch,messageDownload:this.messageDownload},null,8,["messageSearch","messageDownload"])])}const ue=f(de,[["render",he]]);export{ue as default};
