import{_ as p,o as r,c,a as l,n as v,r as _,b as w,t as u,d as f,e as b,F as m}from"./index-75bd2a59.js";const y={name:"download-progress",watch:{downloadProgress(t,e){if(t){let{progress:o,textContent:i}=this.downloadProgress;this.progress=o,this.textContent=i}}},props:{downloadProgress:{type:Object,default:null}},data(){return{progress:null,textContent:null}},methods:{}},V={class:"progress"},$=["textContent"];function k(t,e,o,i,a,n){return r(),c("div",V,[l("div",{ref:"progressDIV",textContent:this.textContent,style:v({width:this.progress}),class:"progress-bar bg-success"},null,12,$)])}const C=p(y,[["render",k]]),D={name:"video-list",components:{DownloadProgress:C},props:{videoList:{type:Object,default:{}},defaultauthor:{type:String,default:""},scrollVid:{type:String,default:null},messageDownload:{type:Object,default:null}},watch:{scrollVid(t,e){t&&this.jumpToTheVideo(t)},async messageDownload(t,e){if(t){let{dowhat:o,info:i,vid:a}=t;switch(o){case"beforeDownInfo":await this.fetchVideoGet(a),await new Promise(n=>setTimeout(n,16)),this.$emit("scroll-vid",a);break;case"updateDownInfo":this.downvid=a,this.updateDownInfo(i);break;case"completeDownInfo":this.downvid=null,this.downloadFileInfo=null,await this.fetchVideoGet(a);break}}}},data(){return{prehost:"http://localhost:16206/",downvid:null,downloadProgress:null,downloadFileInfo:null}},methods:{jumpToTheVideo(t){let e=this.$refs[t];Array.isArray(e)&&e[0].scrollIntoView({behavior:"smooth"})},async fetchVideoGet(t){let e=`${this.prehost}video/vid/${t}`,i=await(await fetch(e)).json();this.videoList[t]=i},updateDownInfo(t){let{filesize:e,progress:o,cn:i,speed:a,eta:n}=t,s=[e,o,a,n].reduce((d,g)=>String(d).concat(" ",g),"");this.downloadFileInfo=s,this.downloadProgress={progress:o,textContent:s}},showDownInfo(t){return this.downvid===t},fetchOpen(t){let e=`${this.prehost}open/localvideo/${t}`;fetch(e).then()},fetchNoticeMP4(t){let e={vid:t,playlist:null},o=`${this.prehost}notice/mp4`,i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};fetch(o,i).then()},async fetchVideoDelete(t,e){let o={vid:t,type:e},i=`${this.prehost}video/`,a={method:"delete",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)};await fetch(i,a)},async handleVideoDelete(t,e,o){switch(await this.fetchVideoDelete(t,o),o){case 1:case 3:delete this.videoList[t];break;case 2:await this.fetchVideoGet(t);break}this.$emit("delete-vid",{vid:t,type:o})},copyText(t){window.navigator.clipboard.writeText(t)}}},A=["id"],T={class:"my-0"},x=l("button",{class:"btn disabled"}," info ",-1),S={class:"btn disabled"},L={class:"btn disabled"},P=["onClick"],j=["onClick"],I=["onClick"],O=["onClick"],N={key:1,class:"btn disabled"},F={key:0,class:"my-3"},G={key:1,class:"my-0"},B=l("button",{class:"btn disabled"}," open ",-1),z=["onClick"],J={key:2,class:"my-0"},M=l("button",{class:"btn disabled"}," not exists ",-1),q={class:"btn disabled"},E={class:"my-0"},H=l("button",{class:"btn disabled"}," delete ",-1),K=["onClick"],Q=["onClick"],R=["onClick"];function U(t,e,o,i,a,n){const h=_("DownloadProgress");return r(!0),c(m,null,w(this.videoList,s=>(r(),c("div",{class:"row border my-3",key:s.vid,id:s.vid,ref_for:!0,ref:s.vid},[l("div",T,[x,l("button",S,u(s.vid),1),l("button",L,u(s.quality),1),l("button",{class:"btn btn-outline-info",onClick:d=>n.copyText(s.title)},"title ",8,P),l("button",{class:"btn btn-outline-info",onClick:d=>n.copyText(s.description)},"description ",8,j),l("button",{class:"btn btn-outline-info",onClick:d=>n.copyText(s.vlink)},"video link ",8,I),s.exists===!1?(r(),c("button",{key:0,class:"btn btn-outline-info",onClick:d=>n.fetchNoticeMP4(s.vid)},"redownload ",8,O)):f("",!0),this.showDownInfo(s.vid)?(r(),c("button",N,u(this.downloadFileInfo),1)):f("",!0)]),this.showDownInfo(s.vid)?(r(),c("div",F,[b(h,{downloadProgress:this.downloadProgress},null,8,["downloadProgress"])])):f("",!0),s.exists?(r(),c("div",G,[B,l("button",{onClick:d=>n.fetchOpen(s.vid),class:"btn btn-outline-primary"},u(s.title),9,z)])):(r(),c("div",J,[M,l("button",q,u(s.title),1)])),l("div",E,[H,l("button",{class:"btn btn-outline-danger",onClick:d=>n.handleVideoDelete(s.vid,s.author,1)}," video data ",8,K),l("button",{class:"btn btn-outline-danger",onClick:d=>n.handleVideoDelete(s.vid,s.author,2)}," video file ",8,Q),l("button",{class:"btn btn-outline-danger",onClick:d=>n.handleVideoDelete(s.vid,s.author,3)}," video data and file ",8,R)])],8,A))),128)}const W=p(D,[["render",U]]),X={name:"search-nav",components:{VideoList:W},props:{messageSearch:{type:Object,default:null},messageDownload:{type:Object,default:null}},watch:{async messageSearch(t,e){if(t){let{dowhat:o,info:i}=t;switch(o){case"fetchAllAuthor":await this.fetchAllAuthor();break;case"showTheVideo":await this.fetchAllAuthor();let{author:a,vid:n}=i;await this.fetchAuthorVideo(a),await new Promise(h=>setTimeout(h,16)),this.scrollVid=n;break}}}},data(){return{prehost:"http://localhost:16206/",defaultauthor:"All Author",authorList:{},videoList:{},searchType:!0,searchTypText:"author",scrollVid:null}},methods:{setScrollVid(t){this.scrollVid=t},titleChange(t){this.videoList=null;let e=t.target.value;if(e.length>0){let o=`${this.prehost}video/title/${e}`;fetch(o).then(i=>i.json()).then(i=>{this.videoList=i})}},changeSearchType(){this.searchType=!this.searchType,this.searchTypText=this.searchType?"author":"title",this.videoList=null},deleteVid(t){},deleteAuthor(t){delete this.authorList[t];let e=`${this.prehost}notice/fetchallauthor`;fetch(e)},goAllAuthor(t){this.$refs.selectOnAuthor.value=t},async fetchAllAuthor(){let t=`${this.prehost}video/authors`,o=await(await fetch(t)).json();this.authorList=o},async fetchAuthorVideo(t){this.$refs.selectOnAuthor.value=t;let e=`${this.prehost}video/author/${t}`,i=await(await fetch(e)).json();this.videoList=i},authorChange(t){let e=t.target.value;e.includes(this.defaultauthor)?this.videoList=null:this.fetchAuthorVideo(e)}},async created(){await this.fetchAllAuthor()}},Y={class:"row my-3"},Z={class:"col-auto"},tt={class:"btn btn-secondary disabled"},et={key:0,class:"col-auto"},st=["value"],ot=["value"],nt={key:1,class:"col-auto"},lt={for:"vtitle"};function it(t,e,o,i,a,n){const h=_("VideoList");return r(),c("div",null,[l("div",Y,[l("div",Z,[l("button",{onClick:e[0]||(e[0]=(...s)=>n.changeSearchType&&n.changeSearchType(...s)),class:"btn btn-outline-primary"},"search "),l("button",tt,u(this.searchTypText),1)]),a.searchType?(r(),c("div",et,[l("select",{ref:"selectOnAuthor",class:"form-select","aria-label":"Default select example",onChange:e[1]||(e[1]=(...s)=>n.authorChange&&n.authorChange(...s))},[l("option",{selected:"",value:this.defaultauthor},u(this.defaultauthor),9,st),(r(!0),c(m,null,w(this.authorList,s=>(r(),c("option",{value:s,key:s},u(s),9,ot))),128))],544)])):(r(),c("div",nt,[l("label",lt,[l("input",{onInput:e[2]||(e[2]=(...s)=>n.titleChange&&n.titleChange(...s)),class:"form-control",id:"vtitle",type:"text",placeholder:"type title to search"},null,32)])]))]),b(h,{videoList:this.videoList,defaultauthor:this.defaultauthor,messageDownload:this.messageDownload,scrollVid:this.scrollVid,onScrollVid:n.setScrollVid,onDeleteVid:n.deleteVid,onGoAllauthor:n.goAllAuthor,onDeleteAuthor:n.deleteAuthor},null,8,["videoList","defaultauthor","messageDownload","scrollVid","onScrollVid","onDeleteVid","onGoAllauthor","onDeleteAuthor"])])}const at=p(X,[["render",it]]),rt={name:"search-view",components:{SearchNav:at},props:{messageSearch:{type:Object,default:null},messageDownload:{type:Object,default:null}}},ct={class:"container-fluid"};function dt(t,e,o,i,a,n){const h=_("SearchNav");return r(),c("div",ct,[b(h,{messageSearch:this.messageSearch,messageDownload:this.messageDownload},null,8,["messageSearch","messageDownload"])])}const ut=p(rt,[["render",dt]]);export{ut as default};
