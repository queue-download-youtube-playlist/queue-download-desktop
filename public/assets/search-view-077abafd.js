import{_ as p,o as i,c as r,a,n as y,r as _,b,t as c,d as f,e as w,F as m}from"./index-db393a7b.js";const v={name:"download-progress",watch:{downloadProgress(e,t){if(e){let{progress:o,textContent:n}=this.downloadProgress;this.progress=o,this.textContent=n}}},props:{downloadProgress:{type:Object,default:null}},data(){return{progress:null,textContent:null}},methods:{}},V={class:"progress"},$=["textContent"];function k(e,t,o,n,h,l){return i(),r("div",V,[a("div",{ref:"progressDIV",textContent:this.textContent,style:y({width:this.progress}),class:"progress-bar bg-success"},null,12,$)])}const C=p(v,[["render",k]]),D={name:"video-list",components:{DownloadProgress:C},props:{videoList:{type:Object,default:{}},defaultauthor:{type:String,default:""},scrollVid:{type:String,default:null},messageDownload:{type:Object,default:null}},watch:{scrollVid(e,t){e&&this.jumpToTheVideo(e)},async messageDownload(e,t){if(e){let{dowhat:o,info:n,vid:h}=e;switch(o){case"beforeDownInfo":let{author:l}=await this.fetchVideoGet(h);this.$emit("show-the-vid",{author:l,vid:h});break;case"updateDownInfo":this.downvid=h,this.updateDownInfo(n);break;case"completeDownInfo":this.downvid=null,this.downloadFileInfo=null,await this.fetchVideoGet(h);break}}}},data(){return{prehost:"http://localhost:16206/",downvid:null,downloadProgress:null,downloadFileInfo:null}},methods:{jumpToTheVideo(e){let t=this.$refs[e];Array.isArray(t)&&t[0].scrollIntoView({behavior:"smooth"})},async fetchVideoGet(e){let t=`${this.prehost}video/vid/${e}`,n=await(await fetch(t)).json();return this.videoList[e]=n,n},updateDownInfo(e){let{filesize:t,progress:o,cn:n,speed:h,eta:l}=e,s=[t,o,h,l].reduce((d,g)=>String(d).concat(" ",g),"");this.downloadFileInfo=s,this.downloadProgress={progress:o,textContent:s}},showDownInfo(e){return this.downvid===e},fetchOpen(e){let t=`${this.prehost}open/localvideo/${e}`;fetch(t).then()},fetchNoticeMP4(e){let t={vid:e,playlist:null},o=`${this.prehost}notice/mp4`,n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};fetch(o,n).then()},async fetchVideoDelete(e,t){let o={vid:e,type:t},n=`${this.prehost}video/`,h={method:"delete",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)};await fetch(n,h)},async handleVideoDelete(e,t,o){switch(await this.fetchVideoDelete(e,o),o){case 1:case 3:delete this.videoList[e];break;case 2:await this.fetchVideoGet(e);break}},copyText(e){window.navigator.clipboard.writeText(e)}}},T=["id"],A={class:"my-0"},x=a("button",{class:"btn disabled"}," info ",-1),S={class:"btn disabled"},L={class:"btn disabled"},j=["onClick"],I=["onClick"],O=["onClick"],P=["onClick"],N={key:1,class:"btn disabled"},F={key:0,class:"my-3"},G={key:1,class:"my-0"},B=a("button",{class:"btn disabled"}," open ",-1),z=["onClick"],J={key:2,class:"my-0"},M=a("button",{class:"btn disabled"}," not exists ",-1),q={class:"btn disabled"},E={class:"my-0"},H=a("button",{class:"btn disabled"}," delete ",-1),K=["onClick"],Q=["onClick"],R=["onClick"];function U(e,t,o,n,h,l){const u=_("DownloadProgress");return i(!0),r(m,null,b(this.videoList,s=>(i(),r("div",{class:"row border my-3",key:s.vid,id:s.vid,ref_for:!0,ref:s.vid},[a("div",A,[x,a("button",S,c(s.vid),1),a("button",L,c(s.quality),1),a("button",{class:"btn btn-outline-info",onClick:d=>l.copyText(s.title)},"title ",8,j),a("button",{class:"btn btn-outline-info",onClick:d=>l.copyText(s.description)},"description ",8,I),a("button",{class:"btn btn-outline-info",onClick:d=>l.copyText(s.vlink)},"video link ",8,O),s.exists===!1?(i(),r("button",{key:0,class:"btn btn-outline-info",onClick:d=>l.fetchNoticeMP4(s.vid)},"redownload ",8,P)):f("",!0),this.showDownInfo(s.vid)?(i(),r("button",N,c(this.downloadFileInfo),1)):f("",!0)]),this.showDownInfo(s.vid)?(i(),r("div",F,[w(u,{downloadProgress:this.downloadProgress},null,8,["downloadProgress"])])):f("",!0),s.exists?(i(),r("div",G,[B,a("button",{onClick:d=>l.fetchOpen(s.vid),class:"btn btn-outline-primary"},c(s.title),9,z)])):(i(),r("div",J,[M,a("button",q,c(s.title),1)])),a("div",E,[H,a("button",{class:"btn btn-outline-danger",onClick:d=>l.handleVideoDelete(s.vid,s.author,1)}," video data ",8,K),a("button",{class:"btn btn-outline-danger",onClick:d=>l.handleVideoDelete(s.vid,s.author,2)}," video file ",8,Q),a("button",{class:"btn btn-outline-danger",onClick:d=>l.handleVideoDelete(s.vid,s.author,3)}," video data and file ",8,R)])],8,T))),128)}const W=p(D,[["render",U]]),X={name:"search-nav",components:{VideoList:W},props:{messageSearch:{type:Object,default:null},messageDownload:{type:Object,default:null}},watch:{async messageSearch(e,t){if(e){let{dowhat:o,info:n}=e;switch(o){case"fetchAllAuthor":await this.fetchAllAuthor();break;case"showTheVideo":await this.showTheVideo(n);break}}}},data(){return{prehost:"http://localhost:16206/",defaultauthor:"All Author",authorList:{},videoList:{},searchType:!0,searchTypText:"author",scrollVid:null}},methods:{async showTheVideo(e){await this.fetchAllAuthor();let{author:t,vid:o}=e;await this.fetchAuthorVideo(t),await new Promise(n=>setTimeout(n,16)),this.scrollVid=o},titleChange(e){this.videoList=null;let t=e.target.value;if(t.length>0){let o=`${this.prehost}video/title/${t}`;fetch(o).then(n=>n.json()).then(n=>{this.videoList=n})}},changeSearchType(){this.searchType=!this.searchType,this.searchTypText=this.searchType?"author":"title",this.videoList=null},deleteVid(e){},deleteAuthor(e){delete this.authorList[e];let t=`${this.prehost}notice/fetchallauthor`;fetch(t)},goAllAuthor(e){this.$refs.selectOnAuthor.value=e},async fetchAllAuthor(){let e=`${this.prehost}video/authors`,o=await(await fetch(e)).json();this.authorList=o},async fetchAuthorVideo(e){this.$refs.selectOnAuthor.value=e;let t=`${this.prehost}video/author/${e}`,n=await(await fetch(t)).json();this.videoList=n},authorChange(e){let t=e.target.value;t.includes(this.defaultauthor)?this.videoList=null:this.fetchAuthorVideo(t)}},async created(){await this.fetchAllAuthor()}},Y={class:"row my-3"},Z={class:"col-auto"},ee={class:"btn btn-secondary disabled"},te={key:0,class:"col-auto"},se=["value"],oe=["value"],ne={key:1,class:"col-auto"},le={for:"vtitle"};function ae(e,t,o,n,h,l){const u=_("VideoList");return i(),r("div",null,[a("div",Y,[a("div",Z,[a("button",{onClick:t[0]||(t[0]=(...s)=>l.changeSearchType&&l.changeSearchType(...s)),class:"btn btn-outline-primary"},"search "),a("button",ee,c(this.searchTypText),1)]),h.searchType?(i(),r("div",te,[a("select",{ref:"selectOnAuthor",class:"form-select","aria-label":"Default select example",onChange:t[1]||(t[1]=(...s)=>l.authorChange&&l.authorChange(...s))},[a("option",{selected:"",value:this.defaultauthor},c(this.defaultauthor),9,se),(i(!0),r(m,null,b(this.authorList,s=>(i(),r("option",{value:s,key:s},c(s),9,oe))),128))],544)])):(i(),r("div",ne,[a("label",le,[a("input",{onInput:t[2]||(t[2]=(...s)=>l.titleChange&&l.titleChange(...s)),class:"form-control",id:"vtitle",type:"text",placeholder:"type title to search"},null,32)])]))]),w(u,{videoList:this.videoList,defaultauthor:this.defaultauthor,messageDownload:this.messageDownload,scrollVid:this.scrollVid,onShowTheVid:l.showTheVideo,onDeleteVid:l.deleteVid,onGoAllauthor:l.goAllAuthor,onDeleteAuthor:l.deleteAuthor},null,8,["videoList","defaultauthor","messageDownload","scrollVid","onShowTheVid","onDeleteVid","onGoAllauthor","onDeleteAuthor"])])}const ie=p(X,[["render",ae]]),re={name:"search-view",components:{SearchNav:ie},props:{messageSearch:{type:Object,default:null},messageDownload:{type:Object,default:null}}},he={class:"container-fluid"};function de(e,t,o,n,h,l){const u=_("SearchNav");return i(),r("div",he,[w(u,{messageSearch:this.messageSearch,messageDownload:this.messageDownload},null,8,["messageSearch","messageDownload"])])}const ue=p(re,[["render",de]]);export{ue as default};
