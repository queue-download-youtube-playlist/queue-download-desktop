import{_ as f,o as i,c as r,a,n as y,r as w,b,t as c,d as p,e as _,F as m}from"./index-d5bff51b.js";const v={name:"download-progress",watch:{downloadProgress(e,t){if(e){let{progress:o,textContent:l}=this.downloadProgress;this.progress=o,this.textContent=l}}},props:{downloadProgress:{type:Object,default:null}},data(){return{progress:null,textContent:null}},methods:{}},V={class:"progress"},$=["textContent"];function k(e,t,o,l,d,n){return i(),r("div",V,[a("div",{ref:"progressDIV",textContent:this.textContent,style:y({width:this.progress}),class:"progress-bar bg-success"},null,12,$)])}const D=f(v,[["render",k]]),C={name:"video-list",components:{DownloadProgress:D},props:{videoList:{type:Object,default:{}},defaultauthor:{type:String,default:""},scrollVid:{type:String,default:null},messageDownload:{type:Object,default:null}},watch:{scrollVid(e,t){e&&this.jumpToTheVideo(e)},async messageDownload(e,t){if(e){let{dowhat:o,info:l,vid:d}=e;switch(o){case"beforeDownInfo":let{author:n}=await this.fetchVideoGet(d);this.$emit("show-the-vid",{author:n,vid:d});break;case"updateDownInfo":this.downvid=d,this.updateDownInfo(l);break;case"completeDownInfo":this.downvid=null,this.downloadFileInfo=null,await this.fetchVideoGet(d);break}}}},data(){return{prehost:"http://localhost:16206/",downvid:null,downloadProgress:null,downloadFileInfo:null}},methods:{jumpToTheVideo(e){let t=this.$refs[e];Array.isArray(t)&&t[0].scrollIntoView({behavior:"smooth"})},async fetchVideoGet(e){let t=`${this.prehost}video/vid/${e}`,l=await(await fetch(t)).json();return this.videoList[e]=l,l},updateDownInfo(e){let{filesize:t,progress:o,cn:l,speed:d,eta:n}=e,s=[t,o,d,n].reduce((h,g)=>String(h).concat(" ",g),"");this.downloadFileInfo=s,this.downloadProgress={progress:o,textContent:s}},showDownInfo(e){return this.downvid===e},fetchOpen(e){let t=`${this.prehost}open/localvideo/${e}`;fetch(t).then()},async fetchRedownload(e){let t=`${this.prehost}video/redownload/${e}`;await fetch(t)},async handleRedownload(e,t){await this.handleVideoDelete(e,t,2),await this.fetchRedownload(e),await this.fetchVideoGet(e)},async fetchVideoDelete(e,t){let o={vid:e,type:t},l=`${this.prehost}video/`,d={method:"delete",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)};await fetch(l,d)},async handleVideoDelete(e,t,o){switch(await this.fetchVideoDelete(e,o),o){case 1:case 3:delete this.videoList[e],Object.keys(this.videoList).length===0&&this.$emit("delete-author",t);break;case 2:await this.fetchVideoGet(e);break}this.$emit("delete-vid",{vid:e,type:o})},copyText(e){window.navigator.clipboard.writeText(e)}}},T=["id"],A={class:"my-0"},x=a("button",{class:"btn disabled"}," info ",-1),L={class:"btn disabled"},S=["onClick"],j=["onClick"],I=["onClick"],O=["onClick"],P={key:1,class:"btn disabled"},G={key:0,class:"my-3"},N={key:1,class:"my-0"},F=a("button",{class:"btn disabled"}," open ",-1),R=["onClick"],B={key:2,class:"my-0"},z=a("button",{class:"btn disabled"}," not exists ",-1),q={class:"btn disabled"},E={class:"my-0"},J=a("button",{class:"btn disabled"}," delete ",-1),H=["onClick"],K=["onClick"],M=["onClick"];function Q(e,t,o,l,d,n){const u=w("DownloadProgress");return i(!0),r(m,null,b(this.videoList,s=>(i(),r("div",{class:"row border my-3",key:s.vid,id:s.vid,ref_for:!0,ref:s.vid},[a("div",A,[x,a("button",L,c(s.quality),1),a("button",{class:"btn btn-outline-info",onClick:h=>n.copyText(s.title)},"title ",8,S),a("button",{class:"btn btn-outline-info",onClick:h=>n.copyText(s.description)},"description ",8,j),a("button",{class:"btn btn-outline-info",onClick:h=>n.copyText(s.downlink)},"download link ",8,I),s.exists===!1?(i(),r("button",{key:0,class:"btn btn-outline-info",onClick:h=>n.handleRedownload(s.vid,s.author)},"redownload ",8,O)):p("",!0),this.showDownInfo(s.vid)?(i(),r("button",P,c(this.downloadFileInfo),1)):p("",!0)]),this.showDownInfo(s.vid)?(i(),r("div",G,[_(u,{downloadProgress:this.downloadProgress},null,8,["downloadProgress"])])):p("",!0),s.exists?(i(),r("div",N,[F,a("button",{style:{"text-overflow":"ellipsis"},onClick:h=>n.fetchOpen(s.vid),class:"btn btn-outline-primary"},c(s.title),9,R)])):(i(),r("div",B,[z,a("button",q,c(s.title),1)])),a("div",E,[J,a("button",{class:"btn btn-outline-danger",onClick:h=>n.handleVideoDelete(s.vid,s.author,1)}," video data ",8,H),a("button",{class:"btn btn-outline-danger",onClick:h=>n.handleVideoDelete(s.vid,s.author,2)}," video file ",8,K),a("button",{class:"btn btn-outline-danger",onClick:h=>n.handleVideoDelete(s.vid,s.author,3)}," video data and file ",8,M)])],8,T))),128)}const U=f(C,[["render",Q]]),W={name:"search-nav",components:{VideoList:U},props:{messageSearch:{type:Object,default:null},messageDownload:{type:Object,default:null}},watch:{async messageSearch(e,t){if(e){let{dowhat:o,info:l}=e;switch(o){case"fetchAllAuthor":await this.fetchAllAuthor();break;case"showTheVideo":await this.showTheVideo(l);break}}}},data(){return{prehost:"http://localhost:16206/",defaultauthor:"All Author",authorList:{},videoList:{},searchType:!0,searchTypText:"author",scrollVid:null}},methods:{async showTheVideo(e){await this.fetchAllAuthor();let{author:t,vid:o}=e;await this.fetchAuthorVideo(t),await new Promise(l=>setTimeout(l,16)),this.scrollVid=o},titleChange(e){this.videoList=null;let t=e.target.value;if(t.length>0){let o=`${this.prehost}video/title/${t}`;fetch(o).then(l=>l.json()).then(l=>{this.videoList=l})}},changeSearchType(){this.searchType=!this.searchType,this.searchTypText=this.searchType?"author":"title",this.videoList=null},deleteVid(e){},deleteAuthor(e){delete this.authorList[e]},goAllAuthor(e){this.$refs.selectOnAuthor.value=e},async fetchAllAuthor(){let e=`${this.prehost}video/authors`,o=await(await fetch(e)).json();this.authorList=o},async fetchAuthorVideo(e){this.$refs.selectOnAuthor.value=e;let t=`${this.prehost}video/author/${e}`,l=await(await fetch(t)).json();this.videoList=l},authorChange(e){let t=e.target.value;t.includes(this.defaultauthor)?this.videoList=null:this.fetchAuthorVideo(t)}},async created(){await this.fetchAllAuthor()}},X={class:"row my-3"},Y={class:"col-auto"},Z={class:"btn btn-secondary disabled"},ee={key:0,class:"col-auto"},te=["value"],se=["value"],oe={key:1,class:"col-auto"},ne={for:"vtitle"};function ae(e,t,o,l,d,n){const u=w("VideoList");return i(),r("div",null,[a("div",X,[a("div",Y,[a("button",{onClick:t[0]||(t[0]=(...s)=>n.changeSearchType&&n.changeSearchType(...s)),class:"btn btn-outline-primary"},"search "),a("button",Z,c(this.searchTypText),1)]),d.searchType?(i(),r("div",ee,[a("select",{ref:"selectOnAuthor",class:"form-select","aria-label":"Default select example",onChange:t[1]||(t[1]=(...s)=>n.authorChange&&n.authorChange(...s))},[a("option",{selected:"",value:this.defaultauthor},c(this.defaultauthor),9,te),(i(!0),r(m,null,b(this.authorList,s=>(i(),r("option",{value:s,key:s},c(s),9,se))),128))],544)])):(i(),r("div",oe,[a("label",ne,[a("input",{onInput:t[2]||(t[2]=(...s)=>n.titleChange&&n.titleChange(...s)),class:"form-control",id:"vtitle",type:"text",placeholder:"type title to search"},null,32)])]))]),_(u,{videoList:this.videoList,defaultauthor:this.defaultauthor,messageDownload:this.messageDownload,scrollVid:this.scrollVid,onShowTheVid:n.showTheVideo,onDeleteVid:n.deleteVid,onGoAllauthor:n.goAllAuthor,onDeleteAuthor:n.deleteAuthor},null,8,["videoList","defaultauthor","messageDownload","scrollVid","onShowTheVid","onDeleteVid","onGoAllauthor","onDeleteAuthor"])])}const le=f(W,[["render",ae]]),ie={name:"search-view",components:{SearchNav:le},props:{messageSearch:{type:Object,default:null},messageDownload:{type:Object,default:null}}},re={class:"container-fluid"};function de(e,t,o,l,d,n){const u=w("SearchNav");return i(),r("div",re,[_(u,{messageSearch:this.messageSearch,messageDownload:this.messageDownload},null,8,["messageSearch","messageDownload"])])}const ce=f(ie,[["render",de]]);export{ce as default};
